<div class="container py-5">
  <h2 class="mb-4"><i class="bi bi-youtube text-danger me-2"></i> Teacher Video Lectures</h2>

  <!-- Filter Section -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <h5 class="mb-0"><i class="bi bi-funnel-fill me-2"></i> Filter Videos</h5>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label for="filterClass" class="form-label fw-bold">Class</label>
          <select id="filterClass" class="form-select" [value]="selectedClass() || 'All'" (change)="onClassChange($event)">
            <option *ngFor="let class of availableClasses()" [value]="class">{{ class === 'All' ? 'All Classes' : class }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="filterSubject" class="form-label fw-bold">Subject</label>
          <select id="filterSubject" class="form-select" [value]="selectedSubject() || 'All'" (change)="onSubjectChange($event)">
            <option *ngFor="let subject of availableSubjects()" [value]="subject">{{ subject === 'All' ? 'All Subjects' : subject }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="filterTeacher" class="form-label fw-bold">Teacher</label>
          <select id="filterTeacher" class="form-select" [value]="selectedTeacherId() || 'All'" (change)="onTeacherChange($event)">
            <option value="All">All Teachers</option>
            <option *ngFor="let teacher of availableTeachers()" [value]="teacher.id">{{ teacher.name }}</option>
          </select>
        </div>
      </div>
      <div class="mt-3 text-end">
        <button type="button" class="btn btn-outline-secondary" (click)="clearFilters()">Clear Filters</button>
      </div>
    </div>
  </div>

  <!-- Statistics Section -->
  <div *ngIf="!isLoadingFilters() && allApprovedVideosWithTeachers().length > 0" class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <h5 class="mb-0"><i class="bi bi-bar-chart-line-fill me-2"></i> Video Statistics</h5>
    </div>
    <div class="card-body">
      <div class="alert alert-info">Total available videos: <strong>{{ allApprovedVideosWithTeachers().length }}</strong></div>
      <div class="accordion" id="statsAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingSubject"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSubject">By Subject ({{ videoCountBySubject().size }})</button></h2>
          <div id="collapseSubject" class="accordion-collapse collapse" data-bs-parent="#statsAccordion">
            <div class="accordion-body"><ul class="list-group list-group-flush"><li *ngFor="let item of videoCountBySubject() | keyvalue" class="list-group-item d-flex justify-content-between align-items-center">{{ item.key }} <span class="badge bg-primary rounded-pill">{{ item.value }}</span></li></ul></div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingClass"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseClass">By Class ({{ videoCountByClass().size }})</button></h2>
          <div id="collapseClass" class="accordion-collapse collapse" data-bs-parent="#statsAccordion">
            <div class="accordion-body"><ul class="list-group list-group-flush"><li *ngFor="let item of videoCountByClass() | keyvalue" class="list-group-item d-flex justify-content-between align-items-center">{{ item.key }} <span class="badge bg-success rounded-pill">{{ item.value }}</span></li></ul></div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTeacher"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTeacher">By Teacher ({{ videoCountByTeacher().size }})</button></h2>
          <div id="collapseTeacher" class="accordion-collapse collapse" data-bs-parent="#statsAccordion">
            <div class="accordion-body"><ul class="list-group list-group-flush"><li *ngFor="let item of videoCountByTeacher() | keyvalue" class="list-group-item d-flex justify-content-between align-items-center">{{ item.key }} <span class="badge bg-secondary rounded-pill">{{ item.value }}</span></li></ul></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading/Error/Empty States -->
  <div *ngIf="isLoading()" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div><p class="mt-2">Loading videos...</p>
  </div>
  <div *ngIf="error()" class="alert alert-danger">{{ error() }}</div>
  <div *ngIf="!isLoading() && !error() && approvedVideos().length === 0" class="alert alert-info">No videos found matching your criteria.</div>

  <!-- Pagination Info -->
  <div *ngIf="!isLoading() && totalVideos() > 0" class="d-flex justify-content-between align-items-center mb-3">
    <span class="text-muted">Showing {{ approvedVideos().length }} of {{ totalVideos() }} videos (Page {{ currentPage() }})</span>
  </div>

  <!-- Video List -->
  <div *ngIf="!isLoading() && approvedVideos().length > 0" class="row g-4">
    <div *ngFor="let video of approvedVideos()" class="col-md-6">
      <div class="card h-100 shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <span class="fw-bold">{{ video.subject }} - Class {{ video.class }}</span>
          <small *ngIf="video.appliedAt" class="text-muted">{{ video.appliedAt.toDate() | date:'shortDate' }}</small>
        </div>
        <div class="card-body">
          <div class="ratio ratio-16x9 mb-3">
            <iframe [src]="getSafeYoutubeUrl(video.video_link)" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
          <p class="card-text">{{ video.short_desc }}</p>
        </div>
        <div class="card-footer bg-light">
          <small class="text-muted"><strong>By:</strong> {{ video.teacherName }}</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="!isLoading() && totalVideos() > pageSize" class="d-flex justify-content-center mt-4">
    <nav>
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage() === 1">
          <button class="page-link" (click)="goToPrevPage()" [disabled]="currentPage() === 1">Previous</button>
        </li>
        <li class="page-item" [class.disabled]="isLastPage()">
          <button class="page-link" (click)="goToNextPage()" [disabled]="isLastPage()">Next</button>
        </li>
      </ul>
    </nav>
  </div>
</div>
