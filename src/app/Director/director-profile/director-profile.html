<div class="container-fluid py-4 py-lg-5 bg-gradient min-vh-100 position-relative overflow-hidden">
  <div class="bg-shapes"></div>
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      <div class="card shadow-2xl border-0 rounded-5 overflow-hidden backdrop-blur-lg" 
           style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
        
        <!-- Header -->
        <div class="card-header bg-gradient-modern text-white d-flex justify-content-between align-items-center p-4 position-relative overflow-hidden" 
             style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); border-bottom: none; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);">
          <div class="position-relative z-10">
            <h2 class="mb-1 fw-bold display-5 lh-1">Director Profile</h2>
            <p class="mb-0 opacity-90 fs-6">Curate your professional narrative with elegance</p>
          </div>
          <div class="d-flex gap-2 position-relative z-10">
            <button *ngIf="!isEditing" class="btn btn-light btn-sm px-4 py-2 rounded-pill fw-semibold transition-all" (click)="toggleEdit()">
              <i class="bi bi-pencil-square me-2"></i> Edit Profile
            </button>
            <button class="btn btn-outline-light btn-sm px-4 py-2 rounded-pill fw-semibold transition-all" (click)="backToDashboard()">
              <i class="bi bi-arrow-left me-2"></i> Back to Dashboard
            </button>
          </div>
        </div>

        <!-- Body -->
        <div class="card-body p-0">
          <!-- Loading -->
          <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center py-5 bg-white/80 backdrop-blur-sm flex-column text-center">
            <div class="spinner-border spinner-border-xl text-primary mb-3 animate-spin-slow" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <h5 class="text-muted fw-medium mb-3">Crafting your profile...</h5>
            <p class="text-muted small mb-3">This may take a moment if your connection is slow.</p>
            <button class="btn btn-outline-primary btn-sm" (click)="retryLoad()" [disabled]="isUploading || isSaving">
              <i class="bi bi-arrow-clockwise me-1"></i> Retry
            </button>
          </div>

          <!-- Profile Content -->
          <div *ngIf="!isLoading && directorProfile" class="bg-white/80 backdrop-blur-sm p-4">
            
            <!-- Errors & Success -->
            <div *ngIf="errorMessage" class="alert alert-danger border-0 rounded-3 mb-3">{{ errorMessage }}</div>
            <div *ngIf="successMessage" class="alert alert-success border-0 rounded-3 mb-3">{{ successMessage }}</div>

            <!-- Display Mode -->
            <div *ngIf="!isEditing" class="row g-5 align-items-center">
              <div class="col-md-4 text-center">
                <img [src]="directorProfile.photoURL || 'https://dummyimage.com/200x200/ced4da/6c757d.png'" 
                     class="rounded-circle shadow-lg mb-3" style="width: 200px; height: 200px; object-fit: cover;" alt="Director Photo">
                <h3 class="fw-bold text-primary">{{ directorProfile.name }}</h3>
                <p class="text-muted fs-5">{{ directorProfile.phone || 'No phone number provided' }}</p>
              </div>
              <div class="col-md-8">
                <h4 class="fw-bold mb-3 border-bottom pb-2">Director's Message</h4>
                <div class="bg-light rounded-3 p-3">
                  <quill-view [content]="directorProfile.message" format="html" theme="snow" class="quill-view-custom"></quill-view>
                </div>
                <h4 class="fw-bold mt-4 mb-3 border-bottom pb-2">About the Director</h4>
                <div class="bg-light rounded-3 p-3">
                  <quill-view [content]="directorProfile.about_director" format="html" theme="snow" class="quill-view-custom"></quill-view>
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="isEditing">
              <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="needs-validation" novalidate>
                <div class="row g-4">
                  <div class="col-md-4 text-center">
                    <div class="position-relative">
                      <img [src]="imagePreviewUrl || 'https://dummyimage.com/200x200/ced4da/6c757d.png'" 
                           class="rounded-circle shadow-lg mb-3" style="width: 200px; height: 200px; object-fit: cover;" alt="Preview">
                      
                      <!-- Gallery Upload - Always Available -->
                      <label class="btn btn-outline-primary btn-sm d-block mb-2 w-100">
                        <i class="bi bi-folder-open me-1"></i> Choose from Gallery
                        <input type="file" accept="image/*" class="d-none" (change)="onFileSelected($event, false)">
                      </label>

                      <!-- Camera Option for Mobile -->
                      <ng-container *ngIf="isMobile">
                        <label class="btn btn-outline-success btn-sm d-block mb-2 w-100">
                          <i class="bi bi-camera me-1"></i> Take Photo with Camera
                          <input type="file" accept="image/*" capture="environment" class="d-none" (change)="onFileSelected($event, true)">
                        </label>
                      </ng-container>

                      <!-- Webcam Option for Desktop -->
                      <ng-container *ngIf="!isMobile">
                        <div class="d-flex flex-column gap-2">
                          <button type="button" class="btn btn-outline-success btn-sm" (click)="startDesktopCamera()" [disabled]="isDesktopCameraActive">
                            <i class="bi bi-camera-video me-1"></i> Use Webcam
                          </button>
                          <button *ngIf="isDesktopCameraActive" type="button" class="btn btn-primary btn-sm" (click)="captureDesktopPhoto()">
                            <i class="bi bi-check-circle me-1"></i> Capture Photo
                          </button>
                          <button *ngIf="isDesktopCameraActive" type="button" class="btn btn-outline-secondary btn-sm" (click)="stopDesktopCamera()">
                            <i class="bi bi-x-circle me-1"></i> Cancel Webcam
                          </button>
                        </div>
                        <video #videoPreview class="d-none rounded shadow-sm mt-2 w-100" autoplay playsinline></video>
                      </ng-container>

                      <!-- Reset Photo Option -->
                      <button *ngIf="imagePreviewUrl && imagePreviewUrl !== (directorProfile?.photoURL || '')" 
                              type="button" class="btn btn-outline-warning btn-sm w-100" (click)="resetPhoto()">
                        <i class="bi bi-arrow-repeat me-1"></i> Reset to Original
                      </button>

                      <!-- Upload Spinner -->
                      <div *ngIf="isUploading" class="mt-3 text-center">
                        <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
                        <span class="text-muted">Uploading...</span>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-8">
                    <div class="mb-3">
                      <label for="name" class="form-label fw-bold">Full Name *</label>
                      <input id="name" type="text" formControlName="name" class="form-control" placeholder="Enter full name">
                    </div>

                    <div class="mb-3">
                      <label for="phone" class="form-label fw-bold">Phone Number</label>
                      <input id="phone" type="tel" formControlName="phone" class="form-control" placeholder="Enter phone number">
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-bold">Director's Message *</label>
                      <quill-editor formControlName="message" [modules]="quillModules" placeholder="Share a short inspirational message..." class="border rounded"></quill-editor>
                    </div>

                    <div class="mb-4">
                      <label class="form-label fw-bold">About the Director *</label>
                      <quill-editor formControlName="about_director" [modules]="quillModules" placeholder="Provide a detailed professional bio..." class="border rounded"></quill-editor>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                      <button type="button" class="btn btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                      <button type="submit" class="btn btn-primary" [disabled]="isSaving || profileForm.invalid || isUploading">
                        <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
                        {{ isSaving ? 'Saving...' : 'Save Profile' }}
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>