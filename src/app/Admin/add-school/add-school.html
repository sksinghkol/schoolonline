<div class="container mt-4">
  <h2 class="mb-4 text-center text-gradient">Manage Schools</h2>

  <!-- Add/Edit Form -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <form [formGroup]="schoolForm" (ngSubmit)="editingSchoolId ? updateSchool() : addSchool()">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">School Name</label>
            <input type="text" class="form-control form-control-lg" formControlName="name" placeholder="Enter school name" required>
            <!-- Slug display -->
            <small class="text-muted d-block mt-1">
              Slug: {{ generateSlug(schoolForm.get('name')?.value) || (editingSchool?.slug) || 'will be generated' }}
            </small>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Logo (upload or paste URL)</label>
            <div class="d-flex gap-2">
              <input type="file" class="form-control" accept="image/*" (change)="onFileSelected($event)">
            </div>
            <small class="text-muted d-block mt-1" *ngIf="selectedFile">Selected file: {{ selectedFile.name }}</small>
            <input type="text" class="form-control mt-2" formControlName="logoUrl" placeholder="Or paste an existing logo URL">
          </div>
        </div>

        <div class="row g-3 mt-3">
          <div class="col-md-4">
            <label class="form-label fw-semibold">Subscription Plan</label>
            <select class="form-select form-select-lg" formControlName="plan" required>
              <option *ngFor="let sub of subscriptions$ | async" [value]="sub.id">
                {{ sub.name }} - {{ sub.price }} {{ sub.currency }}
              </option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label fw-semibold">Seats</label>
            <input type="number" class="form-control form-control-lg" formControlName="seats">
          </div>
          <div class="col-md-3">
            <label class="form-label fw-semibold">Subscription Start</label>
            <input type="date" class="form-control form-control-lg" formControlName="subscriptionStarts">
          </div>
          <div class="col-md-3">
            <label class="form-label fw-semibold">Subscription End</label>
            <input type="date" class="form-control form-control-lg" formControlName="subscriptionEnds">
          </div>
        </div>

        <div class="row g-3 mt-3">
          <div class="col-md-3">
            <label class="form-label fw-semibold">Status</label>
            <select class="form-select form-select-lg" formControlName="status">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <div class="col-md-5">
            <label class="form-label fw-semibold">Address</label>
            <input type="text" class="form-control form-control-lg" formControlName="address">
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Contact</label>
            <input type="text" class="form-control form-control-lg" formControlName="contact">
          </div>
        </div>

        <div class="mt-4 d-flex gap-3 align-items-center">
          <button type="submit" class="btn btn-gradient btn-lg" [disabled]="schoolForm.invalid || uploadingLogo">
            {{ editingSchoolId ? 'Update School' : 'Add School' }}
          </button>
          <span *ngIf="uploadingLogo" class="text-muted ms-2">Uploading logo...</span>
          <button *ngIf="editingSchoolId" type="button" class="btn btn-outline-secondary btn-lg" (click)="cancelEdit()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Schools List -->
  <div class="row g-4">
    <div class="col-md-6 col-lg-4" *ngFor="let school of schools$ | async">
      <div class="card shadow-lg border-0 h-100 hover-shadow">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-start mb-2">
            <img *ngIf="school?.logoUrl" [src]="school?.logoUrl" alt="logo" class="me-3 rounded-circle border" width="50" height="50">
            <div class="flex-grow-1">
              <h5 class="card-title mb-1">
                <a [routerLink]="['/admin-dashboard/schools', school?.id]" class="text-primary text-decoration-none fw-bold">
                  {{ school?.name }}
                </a>
                <small class="text-muted">({{ school?.code }})</small>
              </h5>
              <p class="mb-0">
                Plan: <strong>{{ school?.subscription?.name || '-' }}</strong> |
                Price: <strong>{{ school?.subscription?.price || '-' }} {{ school?.subscription?.currency || '' }}</strong> |
                Seats: <strong>{{ school?.subscription?.seats || '-' }}</strong>
              </p>
              <small class="text-muted d-block mt-1">Slug: {{ school?.slug || '-' }}</small>
            </div>
          </div>

          <div class="mt-auto d-flex justify-content-between align-items-center">
            <div>
              <span class="badge bg-success" *ngIf="school?.status === 'active'">Active</span>
              <span class="badge bg-danger" *ngIf="school?.status === 'inactive'">Inactive</span>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-warning btn-sm" (click)="editSchool(school)">Edit</button>
              <button class="btn btn-danger btn-sm" (click)="removeSchool(school?.id!)">Remove</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
